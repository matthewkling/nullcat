<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Stratified randomization of a quantitative community matrix — quantize • nullcat</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Stratified randomization of a quantitative community matrix — quantize"><meta name="description" content="quantize() is a community null model for quantitative community data
(e.g. abundance, biomass, or occurrence probability). It works by converting
quantitative values into a small number of categorical strata, randomizing
the categorical layout under a chosen categorical null model, and then
reassigning quantitative values within each stratum."><meta property="og:description" content="quantize() is a community null model for quantitative community data
(e.g. abundance, biomass, or occurrence probability). It works by converting
quantitative values into a small number of categorical strata, randomizing
the categorical layout under a chosen categorical null model, and then
reassigning quantitative values within each stratum."><meta property="og:image" content="https://matthewkling.github.io/nullcat/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nullcat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/matthewkling/nullcat/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Stratified randomization of a quantitative community matrix</h1>
      <small class="dont-index">Source: <a href="https://github.com/matthewkling/nullcat/blob/main/R/quantize.R" class="external-link"><code>R/quantize.R</code></a></small>
      <div class="d-none name"><code>quantize.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>quantize()</code> is a community null model for quantitative community data
(e.g. abundance, biomass, or occurrence probability). It works by converting
quantitative values into a small number of categorical strata, randomizing
the categorical layout under a chosen categorical null model, and then
reassigning quantitative values within each stratum.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">quantize</span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  prep <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="nullcat_methods.html">nullcat_methods</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cell"</span>, <span class="st">"stratum"</span>, <span class="st">"row"</span>, <span class="st">"col"</span><span class="op">)</span>,</span>
<span>  breaks <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_strata <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  transform <span class="op">=</span> <span class="va">identity</span>,</span>
<span>  offset <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  zero_stratum <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  n_iter <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>Community matrix with sites in rows, species in columns, and
nonnegative quantitative values in cells. Ignored if <code>prep</code> is
supplied.</p></dd>


<dt id="arg-prep">prep<a class="anchor" aria-label="anchor" href="#arg-prep"></a></dt>
<dd><p>Optional precomputed object returned by
<code><a href="quantize_prep.html">quantize_prep</a></code>. If supplied, <code>x</code> is ignored and all
overhead (stratification, pools, etc.) is taken from <code>prep</code>, which
is typically much faster when generating many randomizations of the same
dataset.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Character string specifying the null model algorithm.
The default <code>"curvecat"</code> uses the categorical curveball algorithm.
See <code><a href="nullcat.html">nullcat</a></code> for alternative options.</p></dd>


<dt id="arg-fixed">fixed<a class="anchor" aria-label="anchor" href="#arg-fixed"></a></dt>
<dd><p>Character string specifying the level at which quantitative
  values are held fixed during randomization. One of:</p><ul><li><p><code>"cell"</code> (the default; only available when <code>method = "curvecat"</code>):
      values remain attached to their original cells and move with them during
      the categorical randomization. Row and column value
      distributions are not preserved, but the mapping between each original
      cell and its randomized destination is fixed.</p></li>
<li><p><code>"stratum"</code>: values are shuffled globally within each stratum,
      holding only the overall stratum-level value distribution fixed.</p></li>
<li><p><code>"row"</code>: values are shuffled within strata separately for each
      row, holding each row’s value multiset fixed. Not compatible with all
      <code>method</code>s.</p></li>
<li><p><code>"col"</code>: values are shuffled within strata separately for each
      column, holding each column’s value multiset fixed.</p></li>
</ul><p>Note that this interacts with <code>method</code>: different null models
fix different margins in the underlying binary representation.</p></dd>


<dt id="arg-breaks">breaks<a class="anchor" aria-label="anchor" href="#arg-breaks"></a></dt>
<dd><p>Numeric vector of stratum breakpoints.</p></dd>


<dt id="arg-n-strata">n_strata<a class="anchor" aria-label="anchor" href="#arg-n-strata"></a></dt>
<dd><p>Integer giving the number of strata to split the
data into. Must be 2 or greater. Larger values yield randomizations
with less mixing but higher fidelity to the original marginal
distributions. Default is <code>5</code>. Ignored unless <code>breaks = NULL</code>.</p></dd>


<dt id="arg-transform">transform<a class="anchor" aria-label="anchor" href="#arg-transform"></a></dt>
<dd><p>A function used to transform the values in
<code>x</code> before assigning them to <code>n_strata</code> equal-width
intervals. Examples include <code>sqrt</code>, <code>log</code>,
<code>rank</code> (for equal-occupancy strata), etc.;
the default is <code>identity</code>. If <code>zero_stratum = TRUE</code>, the
transformation is only applied on nonzero values. The function should
pass NA values. This argument is ignored unless <code>breaks = NULL</code>.</p></dd>


<dt id="arg-offset">offset<a class="anchor" aria-label="anchor" href="#arg-offset"></a></dt>
<dd><p>Numeric value between -1 and 1 (default 0) indicating
how much to shift stratum breakpoints relative to the binwidth (applied
during quantization as: <code>breaks &lt;- breaks + offset * bw</code>). To
assess sensitivity to stratum boundaries, run <code>quantize()</code> multiple
times with different offset values. Ignored unless <code>breaks = NULL</code>.</p></dd>


<dt id="arg-zero-stratum">zero_stratum<a class="anchor" aria-label="anchor" href="#arg-zero-stratum"></a></dt>
<dd><p>Logical indicating whether to segregate zeros into their
own stratum. If <code>FALSE</code> (the default), zeros will likely be combined
into a stratum that also includes small positive numbers. If <code>breaks</code> is
specified, zero simply gets added as an additional break; if not, one
of the <code>n_strata</code> will represent zeros and the others will be nonzero ranges.</p></dd>


<dt id="arg-n-iter">n_iter<a class="anchor" aria-label="anchor" href="#arg-n-iter"></a></dt>
<dd><p>Number of iterations. Default is 1000. Larger values yield
more thorough mixing. Ignored for non-sequential methods. Minimum
burn-in times can be estimated with <a href="suggest_n_iter.html">suggest_n_iter</a>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A randomized version of <code>x</code>, with the same dimensions and
  dimnames. For <code>method = "curvecat"</code>, the quantitative values are
  reassigned within strata while preserving row and column stratum
  multisets. For binary methods, the result corresponds to applying the
  chosen binary null model to each stratum and recombining.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>By default, <code>quantize()</code> will compute all necessary overhead for a
given dataset (strata, pools, etc.) internally. For repeated randomization
of the same matrix (e.g. to build a null distribution), this overhead can be
computed once using <code><a href="quantize_prep.html">quantize_prep</a></code> and reused by supplying the
resulting object via the <code>prep</code> argument.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="co"># toy quantitative community matrix</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="fl">50</span> <span class="op">*</span> <span class="fl">40</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">50</span>,</span></span>
<span class="r-in"><span>               dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"site"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                               <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sp"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">40</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># default: curvecat-backed stratified randomization</span></span></span>
<span class="r-in"><span><span class="va">rand1</span> <span class="op">&lt;-</span> <span class="fu">quantize</span><span class="op">(</span><span class="va">comm</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># change stratification and preservation mode</span></span></span>
<span class="r-in"><span><span class="va">rand2</span> <span class="op">&lt;-</span> <span class="fu">quantize</span><span class="op">(</span><span class="va">comm</span>, n_strata <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>                  transform <span class="op">=</span> <span class="va">sqrt</span>,</span></span>
<span class="r-in"><span>                  fixed  <span class="op">=</span> <span class="st">"row"</span>,</span></span>
<span class="r-in"><span>                  n_iter    <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># use a different randomization algorithm</span></span></span>
<span class="r-in"><span><span class="va">rand3</span> <span class="op">&lt;-</span> <span class="fu">quantize</span><span class="op">(</span><span class="va">comm</span>, method <span class="op">=</span> <span class="st">"swapcat"</span>, n_iter <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># precompute overhead and reuse for many randomizations</span></span></span>
<span class="r-in"><span><span class="va">prep</span>  <span class="op">&lt;-</span> <span class="fu"><a href="quantize_prep.html">quantize_prep</a></span><span class="op">(</span><span class="va">comm</span>, method <span class="op">=</span> <span class="st">"curvecat"</span>,</span></span>
<span class="r-in"><span>                       n_strata <span class="op">=</span> <span class="fl">5</span>, fixed <span class="op">=</span> <span class="st">"row"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rand4</span> <span class="op">&lt;-</span> <span class="fu">quantize</span><span class="op">(</span>prep <span class="op">=</span> <span class="va">prep</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rand5</span> <span class="op">&lt;-</span> <span class="fu">quantize</span><span class="op">(</span>prep <span class="op">=</span> <span class="va">prep</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew Kling.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

