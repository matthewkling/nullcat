<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Prepare stratified null model overhead for quantize() — quantize_prep • nullcat</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Prepare stratified null model overhead for quantize() — quantize_prep"><meta name="description" content="quantize_prep() precomputes all of the stratification and bookkeeping
needed by quantize() for a given quantitative community
matrix. This is useful when you want to generate many randomizations of the
same dataset: the expensive steps (strata assignment, value pools, and
arguments for the underlying null model) are computed once, and the resulting
object can be passed to quantize(prep = ...) for fast repeated draws."><meta property="og:description" content="quantize_prep() precomputes all of the stratification and bookkeeping
needed by quantize() for a given quantitative community
matrix. This is useful when you want to generate many randomizations of the
same dataset: the expensive steps (strata assignment, value pools, and
arguments for the underlying null model) are computed once, and the resulting
object can be passed to quantize(prep = ...) for fast repeated draws."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nullcat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/matthewkling/nullcat/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Prepare stratified null model overhead for quantize()</h1>
      <small class="dont-index">Source: <a href="https://github.com/matthewkling/nullcat/blob/main/R/quantize.R" class="external-link"><code>R/quantize.R</code></a></small>
      <div class="d-none name"><code>quantize_prep.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>quantize_prep()</code> precomputes all of the stratification and bookkeeping
needed by <code><a href="quantize.html">quantize()</a></code> for a given quantitative community
matrix. This is useful when you want to generate many randomizations of the
same dataset: the expensive steps (strata assignment, value pools, and
arguments for the underlying null model) are computed once, and the resulting
object can be passed to <code>quantize(prep = ...)</code> for fast repeated draws.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">quantize_prep</span><span class="op">(</span></span>
<span>  <span class="va">x</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="nullcat_methods.html">nullcat_methods</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  fixed <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cell"</span>, <span class="st">"stratum"</span>, <span class="st">"row"</span>, <span class="st">"col"</span><span class="op">)</span>,</span>
<span>  breaks <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  n_strata <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  transform <span class="op">=</span> <span class="va">identity</span>,</span>
<span>  offset <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  zero_stratum <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  n_iter <span class="op">=</span> <span class="fl">1000</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-x">x<a class="anchor" aria-label="anchor" href="#arg-x"></a></dt>
<dd><p>Community matrix with sites in rows, species in columns, and
nonnegative quantitative values in cells.
This is the dataset for which stratification and null model overhead
should be prepared.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Character string specifying the null model algorithm.
The default <code>"curvecat"</code> uses the categorical curveball algorithm.
See <code><a href="nullcat.html">nullcat</a></code> for alternative options.</p></dd>


<dt id="arg-fixed">fixed<a class="anchor" aria-label="anchor" href="#arg-fixed"></a></dt>
<dd><p>Character string specifying the level at which quantitative
  values are held fixed during randomization. One of:</p><ul><li><p><code>"cell"</code> (the default; only available when <code>method = "curvecat"</code>):
      values remain attached to their original cells and move with them during
      the categorical randomization. Row and column value
      distributions are not preserved, but the mapping between each original
      cell and its randomized destination is fixed.</p></li>
<li><p><code>"stratum"</code>: values are shuffled globally within each stratum,
      holding only the overall stratum-level value distribution fixed.</p></li>
<li><p><code>"row"</code>: values are shuffled within strata separately for each
      row, holding each row’s value multiset fixed. Not compatible with all
      <code>method</code>s.</p></li>
<li><p><code>"col"</code>: values are shuffled within strata separately for each
      column, holding each column’s value multiset fixed.</p></li>
</ul><p>Note that this interacts with <code>method</code>: different null models
fix different margins in the underlying binary representation.</p></dd>


<dt id="arg-breaks">breaks<a class="anchor" aria-label="anchor" href="#arg-breaks"></a></dt>
<dd><p>Numeric vector of stratum breakpoints.</p></dd>


<dt id="arg-n-strata">n_strata<a class="anchor" aria-label="anchor" href="#arg-n-strata"></a></dt>
<dd><p>Integer giving the number of strata to split the
data into. Must be 2 or greater. Larger values yield randomizations
with less mixing but higher fidelity to the original marginal
distributions. Default is <code>5</code>. Ignored unless <code>breaks = NULL</code>.</p></dd>


<dt id="arg-transform">transform<a class="anchor" aria-label="anchor" href="#arg-transform"></a></dt>
<dd><p>A function used to transform the values in
<code>x</code> before assigning them to <code>n_strata</code> equal-width
intervals. Examples include <code>sqrt</code>, <code>log</code>,
<code>rank</code> (for equal-occupancy strata), etc.;
the default is <code>identity</code>. If <code>zero_stratum = TRUE</code>, the
transformation is only applied on nonzero values. The function should
pass NA values. This argument is ignored unless <code>breaks = NULL</code>.</p></dd>


<dt id="arg-offset">offset<a class="anchor" aria-label="anchor" href="#arg-offset"></a></dt>
<dd><p>Numeric value between -1 and 1 (default 0) indicating
how much to shift stratum breakpoints relative to the binwidth (applied
during quantization as: <code>breaks &lt;- breaks + offset * bw</code>). To
assess sensitivity to stratum boundaries, run <code><a href="quantize.html">quantize()</a></code> multiple
times with different offset values. Ignored unless <code>breaks = NULL</code>.</p></dd>


<dt id="arg-zero-stratum">zero_stratum<a class="anchor" aria-label="anchor" href="#arg-zero-stratum"></a></dt>
<dd><p>Logical indicating whether to segregate zeros into their
own stratum. If <code>FALSE</code> (the default), zeros will likely be combined
into a stratum that also includes small positive numbers. If <code>breaks</code> is
specified, zero simply gets added as an additional break; if not, one
of the <code>n_strata</code> will represent zeros and the others will be nonzero ranges.</p></dd>


<dt id="arg-n-iter">n_iter<a class="anchor" aria-label="anchor" href="#arg-n-iter"></a></dt>
<dd><p>Number of iterations. Default is 1000. Larger values yield
more thorough mixing. Ignored for non-sequential methods. Minimum
burn-in times can be estimated with <a href="suggest_n_iter.html">suggest_n_iter</a>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with class <code>"quantize_prep"</code> (if you want to set it)
  containing the components needed by <code><a href="quantize.html">quantize()</a></code>:</p><ul><li><p><code>x</code>: original quantitative marix <code>x</code>,</p></li>
<li><p><code>strata</code>: integer matrix of the same dimension as <code>x</code>,
      giving the stratum index (1, ..., <code>n_strata</code>) for each cell.</p></li>
<li><p><code>stratarray</code>: for binary methods, a 3D array of dimension
      <code>n_strata</code> × <code>nrow(x)</code> × <code>ncol(x)</code> containing the
      binary incidence matrix for each stratum; <code>NULL</code> for
      <code>method = "curvecat"</code>.</p></li>
<li><p><code>pool</code>: data structure encoding the quantitative value pools
      used during reassignment. For <code>"curvecat"</code>, this is a list of
      per-stratum or per-row/column pools depending on <code>fixed</code>; for
      binary methods, it is a matrix of pre-shuffled values.</p></li>
<li><p><code>method</code>: the null model method used (as in the
      <code>method</code> argument).</p></li>
<li><p><code>n_strata</code>, <code>transform</code>, <code>offset</code>, <code>fixed</code>:
      the stratification and reassignment settings used to construct
      <code>strata</code> and <code>pool</code>.</p></li>
<li><p><code>sim_args</code>: named list of arguments to be passed on to
      <code><a href="https://vegandevs.github.io/vegan/reference/nullmodel.html" class="external-link">simulate.nullmodel</a></code> (for binary methods) or used
      internally by <code>curvecat</code> (e.g. <code>n_iter</code>).</p></li>
</ul><p>This object is intended to be passed unchanged to <code><a href="quantize.html">quantize()</a></code>
  via its <code>prep</code> argument.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Internally, <code>quantize_prep()</code>:</p><ul><li><p>transforms and stratifies <code>x</code> into <code>n_strata</code> numeric
    intervals (via <code><a href="stratify.html">stratify()</a></code>),</p></li>
<li><p>constructs the appropriate value pools given <code>fixed</code>
    (either for the categorical <code>"curvecat"</code> backend or for binary
    vegan methods), and</p></li>
<li><p>assembles arguments for the underlying null model call
    (<code><a href="curvecat.html">curvecat</a></code> or <code><a href="https://vegandevs.github.io/vegan/reference/nullmodel.html" class="external-link">simulate.nullmodel</a></code>).</p></li>
</ul><p>The returned object can be reused across calls to <code><a href="quantize.html">quantize()</a></code>,
<code><a href="quantize_null.html">quantize_null()</a></code>, or other helpers that accept a <code>prep</code>
argument.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="fl">50</span> <span class="op">*</span> <span class="fl">40</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">50</span>,</span></span>
<span class="r-in"><span>               dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"site"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">50</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                               <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"sp"</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">40</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># prepare overhead for a curvecat-backed stratified null model</span></span></span>
<span class="r-in"><span><span class="va">prep</span> <span class="op">&lt;-</span> <span class="fu">quantize_prep</span><span class="op">(</span><span class="va">comm</span>, method <span class="op">=</span> <span class="st">"curvecat"</span>,</span></span>
<span class="r-in"><span>                      n_strata <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>                      fixed <span class="op">=</span> <span class="st">"row"</span>,</span></span>
<span class="r-in"><span>                      n_iter <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># fast repeated randomizations using the same prep</span></span></span>
<span class="r-in"><span><span class="va">rand1</span> <span class="op">&lt;-</span> <span class="fu"><a href="quantize.html">quantize</a></span><span class="op">(</span>prep <span class="op">=</span> <span class="va">prep</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rand2</span> <span class="op">&lt;-</span> <span class="fu"><a href="quantize.html">quantize</a></span><span class="op">(</span>prep <span class="op">=</span> <span class="va">prep</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># use a binary vegan method on each stratum</span></span></span>
<span class="r-in"><span><span class="va">prep_bin</span> <span class="op">&lt;-</span> <span class="fu">quantize_prep</span><span class="op">(</span><span class="va">comm</span>, method <span class="op">=</span> <span class="st">"swap"</span>,</span></span>
<span class="r-in"><span>                          n_strata <span class="op">=</span> <span class="fl">4</span>,</span></span>
<span class="r-in"><span>                          burnin <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in quantize_prep(comm, method = "swap", n_strata = 4, burnin = 10000):</span> unused argument (burnin = 10000)</span>
<span class="r-in"><span><span class="va">rand3</span> <span class="op">&lt;-</span> <span class="fu"><a href="quantize.html">quantize</a></span><span class="op">(</span>prep <span class="op">=</span> <span class="va">prep_bin</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> object 'prep_bin' not found</span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew Kling.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

