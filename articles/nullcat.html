<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to nullcat • nullcat</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to nullcat">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nullcat</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/nullcat.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/matthewkling/nullcat/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to nullcat</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/matthewkling/nullcat/blob/main/vignettes/nullcat.Rmd" class="external-link"><code>vignettes/nullcat.Rmd</code></a></small>
      <div class="d-none name"><code>nullcat.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/matthewkling/nullcat" class="external-link">nullcat</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code>nullcat</code> provides null model algorithms for categorical
and quantitative community ecology data. It extends classic binary null
models (e.g., curveball, swap) to work with categorical data, and
introduces a stratified randomization framework for continuous data.</p>
<p>Categorical null models generalize binary null models to matrices
where cells contain integers representing discrete categories. Whereas
binary models preserve totals (e.g. row or column sums), categorical
models preserve <strong>multisets</strong> (e.g. category frequencies in
each row or column). For example, if a row contains [1, 1, 2, 3, 3, 3],
a row-preserving categorical algorithm would preserve this exact
multiset—two 1s, one 2, and three 3s—while randomizing where these
categories appear within the row.</p>
<p>Traditional binary models are simply the specific two-category cases
of their corresponding general categorical models
(e.g. <code>curveball</code> is equivalent to <code>curvecat</code> with
only two categories).</p>
<div class="section level3">
<h3 id="use-cases">Use cases<a class="anchor" aria-label="anchor" href="#use-cases"></a>
</h3>
<p>Categorical null models are designed for <strong>cell-level
categorical data</strong>—characteristics of a species at a site—rather
than site-level or species-level attributes. They can be useful for
categorical and ordinal ecological data. Examples include:</p>
<ul>
<li>Ordinal states: phenological stages, health status, life stages</li>
<li>Multi-state interactions: interaction type, infection status,
mutualism outcomes</li>
<li>Population genetic states: genotypes or allelic frequencies at the
population level</li>
<li>Binned quantitative measures: abundance classes, cover scales, or
occurrence probability bins (the <code><a href="../reference/quantize.html">quantize()</a></code> function
covered below automates binning and randomization)</li>
<li>Binary data: species presence-absence data or similar</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="categorical-null-models">Categorical null models<a class="anchor" aria-label="anchor" href="#categorical-null-models"></a>
</h2>
<div class="section level3">
<h3 id="available-algorithms">Available algorithms<a class="anchor" aria-label="anchor" href="#available-algorithms"></a>
</h3>
<p>The package provides five categorical null model algorithms:</p>
<ul>
<li>
<strong><code><a href="../reference/curvecat.html">curvecat()</a></code></strong>: Categorical curveball
(most efficient)</li>
<li>
<strong><code><a href="../reference/swapcat.html">swapcat()</a></code></strong>: Categorical 2×2 swap</li>
<li>
<strong><code><a href="../reference/tswapcat.html">tswapcat()</a></code></strong>: Categorical
trial-swap</li>
<li>
<strong><code><a href="../reference/r0cat.html">r0cat()</a></code></strong>: Row-constrained
randomization</li>
<li>
<strong><code><a href="../reference/c0cat.html">c0cat()</a></code></strong>: Column-constrained
randomization</li>
</ul>
</div>
<div class="section level3">
<h3 id="example-basic-categorical-randomization">Example: Basic categorical randomization<a class="anchor" aria-label="anchor" href="#example-basic-categorical-randomization"></a>
</h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a categorical matrix</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Randomize using curvecat (preserves row &amp; column category multisets)</span></span>
<span><span class="va">x_rand</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/curvecat.html">curvecat</a></span><span class="op">(</span><span class="va">x</span>, n_iter <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Verify margins are preserved</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">x_rand</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Row preserved</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">x_rand</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Column preserved</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="understanding-fixed-margins">Understanding fixed margins<a class="anchor" aria-label="anchor" href="#understanding-fixed-margins"></a>
</h3>
<p>Different algorithms preserve different margins:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">456</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="fl">60</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fixed-fixed: both row and column margins preserved</span></span>
<span><span class="va">x_fixed</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/curvecat.html">curvecat</a></span><span class="op">(</span><span class="va">x</span>, n_iter <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Row-constrained: only row margins preserved</span></span>
<span><span class="va">x_row</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/r0cat.html">r0cat</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Column-constrained: only column margins preserved</span></span>
<span><span class="va">x_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/c0cat.html">c0cat</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check row sums by category</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span>           <span class="co"># Original row 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 1 2 3 </span></span>
<span><span class="co">#&gt; 2 2 2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x_fixed</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span>     <span class="co"># Preserved in curvecat</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 1 2 3 </span></span>
<span><span class="co">#&gt; 2 2 2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x_row</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span>       <span class="co"># Preserved in r0cat</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 1 2 3 </span></span>
<span><span class="co">#&gt; 2 2 2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">x_col</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span><span class="op">)</span>       <span class="co"># Not preserved in c0cat</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 1 2 3 </span></span>
<span><span class="co">#&gt; 1 3 2</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="quantitative-null-models">Quantitative null models<a class="anchor" aria-label="anchor" href="#quantitative-null-models"></a>
</h2>
<p>The <code><a href="../reference/quantize.html">quantize()</a></code> function provides stratified
randomization for continuous community data (abundance, biomass, cover,
occurrence probability). It works by applying the following steps:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Stratify</strong>: use a flexible binning scheme to convert
continuous values into discrete strata</li>
<li>
<strong>Randomize</strong>: apply one of the categorical null models
described above to the stratified matrix</li>
<li>
<strong>Reassign</strong>: map randomized strata back to original
values, subject to a chosen constraint</li>
</ol>
<p><strong>Why use quantize?</strong> Existing quantitative null models
lack flexibility in what margins they preserve. While binary curveball
elegantly preserves row and column totals, and vegan’s quasiswap models
do this for count data, there’s no framework for preserving row and/or
column <strong>value distributions</strong> for continuous data
(abundance, biomass, cover). The stratification approach fills this gap:
when using <code>fixed = "row"</code> or <code>fixed = "col"</code>, one
dimension’s value multisets are preserved exactly while the other is
preserved at the resolution of strata. This is the closest available
approximation to a quantitative fixed-fixed null model. Additionally,
stratification provides explicit control over the
preservation-randomization tradeoff through the number of strata
used.</p>
<div class="section level3">
<h3 id="example-basic-quantitative-randomization">Example: Basic quantitative randomization<a class="anchor" aria-label="anchor" href="#example-basic-quantitative-randomization"></a>
</h3>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a quantitative community matrix</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">789</span><span class="op">)</span></span>
<span><span class="va">comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Default: curvecat-backed stratified randomization with 5 strata</span></span>
<span><span class="va">rand1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quantize.html">quantize</a></span><span class="op">(</span><span class="va">comm</span>, n_strata <span class="op">=</span> <span class="fl">5</span>, n_iter <span class="op">=</span> <span class="fl">2000</span>, fixed <span class="op">=</span> <span class="st">"row"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Values are similar but rearranged</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">comm</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="va">rand1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.1757922</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">comm</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">rand1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="nullcat_files/figure-html/quantitative-basic-1.png" class="r-plt" width="672"></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">comm</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">rand1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="nullcat_files/figure-html/quantitative-basic-2.png" class="r-plt" width="672"></p>
</div>
<div class="section level3">
<h3 id="stratification-options">Stratification options<a class="anchor" aria-label="anchor" href="#stratification-options"></a>
</h3>
<p>When you call <code><a href="../reference/quantize.html">quantize()</a></code>, it uses the helper function
<code><a href="../reference/stratify.html">stratify()</a></code> to convert your continuous data to discrete
bins. The stratification scheme can strongly influence your
randomization results, because it is frequencies of these categories
that are constrained during matrix permutation. By default, data are
split into a handful of equal-width bins, but this can be controlled
with parameters including <code>n_strata</code>, <code>transform</code>,
<code>zero_stratum</code>, <code>breaks</code>, and <code>offset</code>.
Let’s call <code><a href="../reference/stratify.html">stratify()</a></code> directly here, to understand its
behavior—a good idea for a real analysis, not just a tutorial.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">.1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># More strata = less mixing, higher fidelity to original distribution</span></span>
<span><span class="va">s3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stratify.html">stratify</a></span><span class="op">(</span><span class="va">x</span>, n_strata <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">s10</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stratify.html">stratify</a></span><span class="op">(</span><span class="va">x</span>, n_strata <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">s3</span><span class="op">)</span>   <span class="co"># Coarser bins</span></span>
<span><span class="co">#&gt; s3</span></span>
<span><span class="co">#&gt;  1  2  3 </span></span>
<span><span class="co">#&gt; 89  9  2</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">s10</span><span class="op">)</span>  <span class="co"># Finer bins</span></span>
<span><span class="co">#&gt; s10</span></span>
<span><span class="co">#&gt;  1  2  3  4  5  6 10 </span></span>
<span><span class="co">#&gt; 49 22 17  4  4  2  2</span></span>
<span></span>
<span><span class="co"># Transform before stratifying (e.g., log-transform for skewed data)</span></span>
<span><span class="va">s_log</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stratify.html">stratify</a></span><span class="op">(</span><span class="va">x</span>, n_strata <span class="op">=</span> <span class="fl">5</span>, transform <span class="op">=</span> <span class="va">log1p</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">s_log</span><span class="op">)</span></span>
<span><span class="co">#&gt; s_log</span></span>
<span><span class="co">#&gt;  1  2  3  4  5 </span></span>
<span><span class="co">#&gt; 14 26 27 27  6</span></span>
<span></span>
<span><span class="co"># Rank transform creates equal-occupancy strata</span></span>
<span><span class="va">s_rank</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stratify.html">stratify</a></span><span class="op">(</span><span class="va">x</span>, n_strata <span class="op">=</span> <span class="fl">5</span>, transform <span class="op">=</span> <span class="va">rank</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">s_rank</span><span class="op">)</span>  <span class="co"># Nearly equal counts per stratum</span></span>
<span><span class="co">#&gt; s_rank</span></span>
<span><span class="co">#&gt;  1  2  3  4  5 </span></span>
<span><span class="co">#&gt; 20 20 20 20 20</span></span>
<span></span>
<span><span class="co"># Separate zeros into their own stratum</span></span>
<span><span class="va">x_with_zeros</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="va">x</span><span class="op">)</span></span>
<span><span class="va">s_zero</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stratify.html">stratify</a></span><span class="op">(</span><span class="va">x_with_zeros</span>, n_strata <span class="op">=</span> <span class="fl">4</span>, zero_stratum <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">s_zero</span><span class="op">)</span></span>
<span><span class="co">#&gt; s_zero</span></span>
<span><span class="co">#&gt;  1  2  3  4 </span></span>
<span><span class="co">#&gt;  3 89  9  2</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="controlling-whats-preserved">Controlling what’s preserved<a class="anchor" aria-label="anchor" href="#controlling-whats-preserved"></a>
</h3>
<p>While the mechanics of the chosen randomization algorithm determine
which margins of the randomized <em>categories</em> are preserved, the
<code>fixed</code> parameter controls how the original
<em>continuous</em> values are mapped back onto the randomized
categories, determining which margins preserve their original value
distributions. There are four options for the <code>fixed</code>
parameter: row, col, cell, and stratum, though only a subset of these
are relevant for some algorithms. For a method like the default
<code>curvecat</code> algorithm that preserves both row and column
categorical multisets, all four are available:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Preserve row value multisets (quantitative row sums maintained)</span></span>
<span><span class="va">rand_row</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quantize.html">quantize</a></span><span class="op">(</span><span class="va">comm</span>, n_strata <span class="op">=</span> <span class="fl">5</span>, fixed <span class="op">=</span> <span class="st">"row"</span>, n_iter <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">comm</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">rand_row</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># Preserve column value multisets (quantitative column sums maintained)</span></span>
<span><span class="va">rand_col</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quantize.html">quantize</a></span><span class="op">(</span><span class="va">comm</span>, n_strata <span class="op">=</span> <span class="fl">5</span>, fixed <span class="op">=</span> <span class="st">"col"</span>, n_iter <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/all.equal.html" class="external-link">all.equal</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">comm</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">rand_col</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span></span>
<span><span class="co"># Cell-level preservation: each value moves with its original cell location</span></span>
<span><span class="co"># The categorical randomization determines WHERE cells go, but each cell</span></span>
<span><span class="co"># carries its original value with it</span></span>
<span><span class="va">rand_cell</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quantize.html">quantize</a></span><span class="op">(</span><span class="va">comm</span>, n_strata <span class="op">=</span> <span class="fl">5</span>, fixed <span class="op">=</span> <span class="st">"cell"</span>, n_iter <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Values shuffled globally within strata, holding none of the above fixed</span></span>
<span><span class="va">rand</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quantize.html">quantize</a></span><span class="op">(</span><span class="va">comm</span>, n_strata <span class="op">=</span> <span class="fl">5</span>, fixed <span class="op">=</span> <span class="st">"stratum"</span>, n_iter <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># For non-fixed-fixed methods like r0cat or c0cat, only some fixed options make sense:</span></span>
<span><span class="co"># r0cat with fixed="col" or c0cat with fixed="row" would be incompatible</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="efficient-repeated-randomization">Efficient repeated randomization<a class="anchor" aria-label="anchor" href="#efficient-repeated-randomization"></a>
</h2>
<p>The quantize routine includes some setup, including stratification,
that doesn’t need to be repeatedly recomputed when generating multiple
randomized versions of the same matrix. For generating null
distributions, you can pre-compute overhead once using
<code><a href="../reference/quantize_prep.html">quantize_prep()</a></code>, or you can use <code>*_batch()</code>
functions to efficiently generate multiple replicates (optionally using
parallel processing).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">400</span><span class="op">)</span></span>
<span><span class="va">comm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Prepare once</span></span>
<span><span class="va">prep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quantize_prep.html">quantize_prep</a></span><span class="op">(</span><span class="va">comm</span>, n_strata <span class="op">=</span> <span class="fl">5</span>, fixed <span class="op">=</span> <span class="st">"row"</span>, n_iter <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate many randomizations efficiently</span></span>
<span><span class="va">rand1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quantize.html">quantize</a></span><span class="op">(</span>prep <span class="op">=</span> <span class="va">prep</span><span class="op">)</span></span>
<span><span class="va">rand2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quantize.html">quantize</a></span><span class="op">(</span>prep <span class="op">=</span> <span class="va">prep</span><span class="op">)</span></span>
<span><span class="va">rand3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quantize.html">quantize</a></span><span class="op">(</span>prep <span class="op">=</span> <span class="va">prep</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Or use batch functions</span></span>
<span><span class="va">nulls</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quantize_batch.html">quantize_batch</a></span><span class="op">(</span><span class="va">comm</span>, n_reps <span class="op">=</span> <span class="fl">99</span>, n_strata <span class="op">=</span> <span class="fl">5</span>, </span>
<span>                       fixed <span class="op">=</span> <span class="st">"row"</span>, n_iter <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">nulls</span><span class="op">)</span>  <span class="co"># 20 rows × 10 cols × 99 replicates</span></span>
<span><span class="co">#&gt; [1] 20 10 99</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="convergence-diagnostics">Convergence diagnostics<a class="anchor" aria-label="anchor" href="#convergence-diagnostics"></a>
</h2>
<p>Sequential algorithms (curvecat, swapcat, tswapcat) require
sufficient iterations to reach stationarity. You can use the
<code><a href="../reference/trace_cat.html">trace_cat()</a></code> function with either <code>nullcat</code> or
<code>quantize</code> to assess how many iterations are needed for your
particular dataset and algorithm. The trace shows how similarity to the
original matrix changes over iterations; when the trace stabilizes
around zero, the algorithm has reached stationarity. You can also use
<code><a href="../reference/suggest_n_iter.html">suggest_n_iter()</a></code> to get an automated suggestion for a
reasonable number of burn-in iterations to reach stationarity.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">300</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="fl">400</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Generate trace showing mixing over iterations</span></span>
<span><span class="va">trace</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/trace_cat.html">trace_cat</a></span><span class="op">(</span><span class="va">x</span>, fun <span class="op">=</span> <span class="st">"nullcat"</span>, method <span class="op">=</span> <span class="st">"curvecat"</span>,</span>
<span>                   n_iter <span class="op">=</span> <span class="fl">1000</span>, n_chains <span class="op">=</span> <span class="fl">3</span>, thin <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Visual inspection</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">trace</span><span class="op">)</span></span></code></pre></div>
<p><img src="nullcat_files/figure-html/trace-diagnostics-1.png" class="r-plt" width="672"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Automatic burn-in suggestion</span></span>
<span><span class="va">suggested</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/suggest_n_iter.html">suggest_n_iter</a></span><span class="op">(</span><span class="va">trace</span>, tail_frac <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">suggested</span><span class="op">)</span></span>
<span><span class="co">#&gt; suggested_n_iter object</span></span>
<span><span class="co">#&gt; -----------------------</span></span>
<span><span class="co">#&gt; Converged: TRUE </span></span>
<span><span class="co">#&gt; Suggested n iterations: 410</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="integration-with-vegan">Integration with <code>vegan</code><a class="anchor" aria-label="anchor" href="#integration-with-vegan"></a>
</h2>
<p><code>nullcat</code> includes several functions to integrate with the
<code>vegan</code> package’s null model framework. For both
<code><a href="../reference/nullcat.html">nullcat()</a></code> and <code><a href="../reference/quantize.html">quantize()</a></code>, there are sequential
and non-sequential variants of these functions that create
<code><a href="https://vegandevs.github.io/vegan/reference/commsim.html" class="external-link">vegan::commsim()</a></code> objects suitable for use with
<code><a href="https://vegandevs.github.io/vegan/reference/nullmodel.html" class="external-link">vegan::nullmodel()</a></code> and <code><a href="https://vegandevs.github.io/vegan/reference/oecosimu.html" class="external-link">vegan::oecosimu()</a></code>.
Examples include:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://vegandevs.github.io/vegan/" class="external-link">vegan</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Categorical data</span></span>
<span><span class="va">x_cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="fl">100</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">cs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/nullcat_commsim_seq.html">nullcat_commsim_seq</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"curvecat"</span><span class="op">)</span></span>
<span><span class="va">nm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://vegandevs.github.io/vegan/reference/nullmodel.html" class="external-link">nullmodel</a></span><span class="op">(</span><span class="va">x_cat</span>, <span class="va">cs</span><span class="op">)</span></span>
<span><span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">nm</span>, nsim <span class="op">=</span> <span class="fl">99</span>, burnin <span class="op">=</span> <span class="fl">1000</span>, thin <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Quantitative data</span></span>
<span><span class="va">x_quant</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Exponential.html" class="external-link">rexp</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>, nrow <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">cs_quant</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/quantize_commsim.html">quantize_commsim</a></span><span class="op">(</span>n_strata <span class="op">=</span> <span class="fl">5</span>, method <span class="op">=</span> <span class="st">"curvecat"</span>, n_iter <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span></span>
<span><span class="va">nm_quant</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://vegandevs.github.io/vegan/reference/nullmodel.html" class="external-link">nullmodel</a></span><span class="op">(</span><span class="va">x_quant</span>, <span class="va">cs_quant</span><span class="op">)</span></span>
<span><span class="va">sims_quant</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/simulate.html" class="external-link">simulate</a></span><span class="op">(</span><span class="va">nm_quant</span>, nsim <span class="op">=</span> <span class="fl">99</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ul>
<li>Strona et al. (2014). A fast and unbiased procedure to randomize
ecological binary matrices. <em>Nature Communications</em>, 5,
4114.</li>
<li>Gotelli (2000). Null model analysis of species co-occurrence
patterns. <em>Ecology</em>, 81(9), 2606-2621.</li>
</ul>
</div>
<div class="section level2">
<h2 id="further-reading">Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<ul>
<li>Package website: <a href="https://matthewkling.github.io/nullcat/" class="uri">https://matthewkling.github.io/nullcat/</a>
</li>
<li>Report issues: <a href="https://github.com/matthewkling/nullcat/issues" class="external-link uri">https://github.com/matthewkling/nullcat/issues</a>
</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthew Kling.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
